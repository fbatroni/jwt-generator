/*eslint no-process-env: "off"*/

"use strict";

/********************************************************************
 * Config
 ********************************************************************/

const config = require('../config/config.js');
const jwt = require('jsonwebtoken');

/********************************************************************
 * Main Exports
 ********************************************************************/

module.exports = {
  getRedirectUrlFromJWTCookie: req =>
    new Promise(resolve => resolve(jwt.verify(req.cookies[config.jwtRedirectCookieName], config.jwtSecret)))
};

/********************************************************************
 * Tests
 ********************************************************************/

if (module.parent === null) {
  /** Fake Req */
  const req = {};
  req.headers = {};
  req.headers[config.jwtRedirectCookieName] = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiIvand0Lz9qd3Q9ZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBZWFFpT2pFME5qTTFOVGsyTnpnc0ltVjRjQ0k2TVRRMk16VTJNekkzT0N3aWMzWmpJam9pTDJwM2RDSXNJbVZ3YVNJNk5YMC54bnRPSEEtQklDVzQ2TG5oTm9xd293Z3ZzOW9yakJjMGZVd3YwMTQ5VGYwIiwiaWF0IjoxNDYzNzI5MjMwfQ.Njy42dOzSToqmtOmGZSYiDmImenSHye7lxuIdmbjFTw';
  config.jwtSecret = "CHANGEME";
  module.exports.getRedirectUrlFromJWTCookie(req)
    .then(r => console.log(`Results: ${r}`, r))
    .catch(e => console.error(`Error: ${e}`, e, e.stack));
}
